{
  "hash": "6421498d5d0821552c14631719cc34d8",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'Basics of Randomization Tests'\nabstract: \"What is meant by a Randomization Test?\"\ndate: 27/Nov/2022\ndate-modified: \"2025-07-29\"\nimage: preview.jpg\nimage-alt: \"Photo by Pixabay: https://www.pexels.com/photo/white-and-yellow-playing-cards-39018/\"\norder: 60\ncategories:\n- Randomization\n- Permutation\n- Explanatory Variable\n- Random Number Generation\n- Null Distributions\n---\n\n![](preview.jpg){fig-alt=\"Pick a Card\" fig-align=\"center\" width=\"286\"}\n\n\n::: {.cell}\n\n:::\n\n\n#### Plot Fonts and Theme\n\n\n::: {.cell messages='false'}\n\n```{.r .cell-code  code-fold=\"true\"}\nlibrary(systemfonts)\nlibrary(showtext)\n## Clean the slate\nsystemfonts::clear_local_fonts()\nsystemfonts::clear_registry()\n##\nshowtext_opts(dpi = 96) # set DPI for showtext\nsysfonts::font_add(\n  family = \"Alegreya\",\n  regular = \"../../../../../../fonts/Alegreya-Regular.ttf\",\n  bold = \"../../../../../../fonts/Alegreya-Bold.ttf\",\n  italic = \"../../../../../../fonts/Alegreya-Italic.ttf\",\n  bolditalic = \"../../../../../../fonts/Alegreya-BoldItalic.ttf\"\n)\n\nsysfonts::font_add(\n  family = \"Roboto Condensed\",\n  regular = \"../../../../../../fonts/RobotoCondensed-Regular.ttf\",\n  bold = \"../../../../../../fonts/RobotoCondensed-Bold.ttf\",\n  italic = \"../../../../../../fonts/RobotoCondensed-Italic.ttf\",\n  bolditalic = \"../../../../../../fonts/RobotoCondensed-BoldItalic.ttf\"\n)\nshowtext_auto(enable = TRUE) # enable showtext\n##\ntheme_custom <- function() {\n  font <- \"Alegreya\" # assign font family up front\n\n  theme_classic(base_size = 14, base_family = font) %+replace% # replace elements we want to change\n\n    theme(\n      text = element_text(family = font), # set base font family\n\n      # text elements\n      plot.title = element_text( # title\n        family = font, # set font family\n        size = 24, # set font size\n        face = \"bold\", # bold typeface\n        hjust = 0, # left align\n        margin = margin(t = 5, r = 0, b = 5, l = 0)\n      ), # margin\n      plot.title.position = \"plot\",\n      plot.subtitle = element_text( # subtitle\n        family = font, # font family\n        size = 14, # font size\n        hjust = 0, # left align\n        margin = margin(t = 5, r = 0, b = 10, l = 0)\n      ), # margin\n\n      plot.caption = element_text( # caption\n        family = font, # font family\n        size = 9, # font size\n        hjust = 1\n      ), # right align\n\n      plot.caption.position = \"plot\", # right align\n\n      axis.title = element_text( # axis titles\n        family = \"Roboto Condensed\", # font family\n        size = 12\n      ), # font size\n\n      axis.text = element_text( # axis text\n        family = \"Roboto Condensed\", # font family\n        size = 9\n      ), # font size\n\n      axis.text.x = element_text( # margin for axis text\n        margin = margin(5, b = 10)\n      )\n\n      # since the legend often requires manual tweaking\n      # based on plot content, don't define it here\n    )\n}\n```\n:::\n\n\n\n\n::: {.cell}\n\n````{.cell-code  code-fold=\"true\"}\n```{{r}}\n#| cache: false\n#| code-fold: true\n## Set the theme\ntheme_set(new = theme_custom())\n```\n````\n\n::: {.cell-output .cell-output-error}\n\n```\nError in theme_set(new = theme_custom()): could not find function \"theme_set\"\n```\n\n\n:::\n\n````{.cell-code  code-fold=\"true\"}\n```{{r}}\n#| cache: false\n#| code-fold: true\n## Use available fonts in ggplot text geoms too!\nupdate_geom_defaults(geom = \"text\", new = list(\n  family = \"Roboto Condensed\",\n  face = \"plain\",\n  size = 3.5,\n  color = \"#2b2b2b\"\n))\n```\n````\n\n::: {.cell-output .cell-output-error}\n\n```\nError in update_geom_defaults(geom = \"text\", new = list(family = \"Roboto Condensed\", : could not find function \"update_geom_defaults\"\n```\n\n\n:::\n:::\n\n\n\n\n\n## Introduction: The Lady who Drank Tea\n\n> There is a famous story about a lady who claimed that tea with milk\n> tasted different depending on whether the milk was added to the tea or\n> the tea added to the milk. The story is famous because of the setting\n> in which she made this claim. She was attending a party in Cambridge,\n> England, in the 1920s. Also in attendance were a number of university\n> dons and their wives. The scientists in attendance scoffed at the\n> woman and her claim. What, after all, could be the difference?\n>\n> All the scientists but one, that is. Rather than simply dismiss the\n> woman's claim, he proposed that they decide how one should test the\n> claim. The tenor of the conversation changed at this suggestion, and\n> the scientists began to discuss how the claim should be tested. Within\n> a few minutes cups of tea with milk had been prepared and presented to\n> the woman for tasting.\n>\n> At this point, you may be wondering who the innovative scientist was\n> and what the results of the experiment were. The scientist was R. A.\n> Fisher, who first described this situation as a pedagogical example in\n> his 1925 book on statistical methodology\\[\\^1\\]. Fisher developed\n> statistical methods that are among the most important and widely used\n> methods to this day, and most of his applications were biological.\n\n### Game\n\nLet's try an experiment. I'll flip 10 coins. You guess which are heads\nand which are tails, and we'll see how you do. Please write down a\nsequence of \"H\" or \"T\". Comparing with your classmates, we will\nundoubtedly see that some of you did better and others worse.\n\nWhat would be your impression of one of you got 9 guesses correct? Is\nthat SKILL or is that something else? What would be your **immediate\nreaction** and **next move**?\n\n### Analysis\n\nBack to the Lady who drank Tea !!\n\n> Let's suppose we decide to test the lady with ten cups of tea. We'll\n> flip a coin to decide which way to prepare the cups. If we flip a\n> head, we will pour the milk in first; if tails, we put the tea in\n> first. Then we present the ten cups to the lady and have her state\n> which ones she thinks were prepared each way.\n>\n> It is easy to give her a score (9 out of 10, or 7 out of 10, or\n> whatever it happens to be). It is trickier to figure out what to do\n> with her score. Even if she is just guessing and has no idea, she\n> could get lucky and get quite a few correct -- maybe even all 10. But\n> how likely is that?\n>\n> Now let's suppose the lady gets 9 out of 10 correct. That's not\n> perfect, but it is better than we would expect for someone who was\n> just guessing. On the other hand, it is not impossible to get 9 out of\n> 10 just by guessing.\n>\n> So here is Fisher's great idea: **Let's figure out how hard it is to\n> get 9 out of 10 by guessing**. If it's not so hard to do, then perhaps\n> that's just what happened ( that she was guessing ), so we won't be\n> too impressed with the lady's tea tasting ability. On the other hand,\n> if it is really unusual to get 9 out of 10 correct by guessing, then\n> we will have some evidence that she must be able to tell something (\n> and has an unusual Skill).\n>\n> But how do we figure out how unusual it is to get 9 out of 10 just by\n> guessing? Let's just flip a bunch of coins and keep track. If the lady\n> is just guessing, she might as well be flipping a coin.\n>\n> So here's the plan. We'll flip 10 coins, and repeat that experiment\n> 10000 times. We'll call the heads correct guesses and the tails\n> incorrect guesses.\n\n\n::: {.cell caption='Can we get 10/10 heads?'}\n::: {.cell-output .cell-output-stdout}\n\n```\nheads\n   0    1    2    3    4    5    6    7    8    9   10 \n   9  110  413 1145 2096 2446 2066 1141  469   97    8 \n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/fig-all-10-heads-1.png){#fig-all-10-heads width=2100}\n:::\n:::\n\n\nSo what do we conclude? It is possible that the lady could get 9 or 10\ncorrect just by guessing, but it is not very likely (it only happened in\nabout $\\frac{97+8}{10000} = 1.05\\%$ of our simulations). So one of two\nthings must be true:\\\n• The lady got unusually \"lucky\", by chance; OR\\\n• The lady is not just guessing and really has some ability in this\nregard.\n\n## Commentary\n\nFirst we realize something is **surprising**, and that we have a\n**question** or **doubt**. This is based on something we see, or\nmeasure, a **test statistic**. In our story, it is the **score** of\n$10/10$ that the Lady was able to achieve about how the Tea was made.\n\nWe then **assume** the Lady is guessing *and* somehow **by chance** able\nto guess correctly. This would be our....**NULL Hypothesis**. This is\nour (conservative) *belief* about the **Real World**.\n\nWe then *randomly generate* many **Parallel Counterfactual Worlds**,\nwhere we repeat the experiment many many times, each time calculating\nthe *test statistic*, under the *assumption* of the NULL Hypothesis is\nTRUE.\n\nWe see how often our *Parallel Worlds* can mimic or exceed *Real World*\nmeasurement of the the *test statistic* by comparison. If this is common\n(i.e. probability is high) we say we cannot reject the NULL Hypothesis\n(and the Lady is lucky). If the occurrence is rare, as in our case, we\nsay we have reason to reject the NULL Hypothesis and reason to believe\nan underlying pattern (and Lady's ability is beyond **Question** !)\n\nThis is the essence of the **Simulation Method** in statistical\nmodelling. Take one more look at the picture from Allen Downey's blog,\nbelow:\n\n![](images/One-Test.png)\n\nFrom Reference #1:\n\n> Hypothesis testing can be thought of as a 4-step process:\n>\n> 1.  State the null and alternative hypotheses.\n>\n> 2.  Compute a test statistic.\n>\n> 3.  Determine the p-value.\n>\n> 4.  Draw a conclusion.\n>\n>     In a traditional introductory statistics course, once this general\n>     framework has been mastered, the main work is in **applying the\n>     correct formula** to compute the standard test statistics in step\n>     2 and using a table or computer to **determine the p-value** based\n>     on the known (usually approximate) **theoretical distribution of\n>     the test statistic** under the null hypothesis.\n>\n>     In a **simulation-based approach**, steps 2 and 3 change. In Step\n>     2, it is no longer required that the test statistic be normalized\n>     to conform with a known, named distribution. Instead, natural test\n>     statistics, like the difference between two sample means $y1 − y2$\n>     can be used.\n>\n>     In Step 3, we use **randomization to approximate the sampling\n>     distribution of the test statistic**. Our lady tasting tea example\n>     demonstrates how this can be done from first principles. More\n>     typically, we will use randomization **to create new simulated\n>     data sets** ( \"*Parallel Worlds*\") that are like our original data\n>     in some ways, but make the null hypothesis true. For each\n>     simulated data set, we calculate our test statistic, just as we\n>     did for the original sample. Together, this collection of test\n>     statistics computed from the simulated samples constitute our\n>     randomization distribution.\n>\n>     When creating a randomization distribution, we will attempt to\n>     satisfy 3 guiding principles.\n>\n> 5.  Be consistent with the null hypothesis. We need to **simulate a\n>     world** in which the null hypothesis is true. If we don't do this,\n>     we won't be testing our null hypothesis.\n>\n> 6.  Use the data in the **original sample**. The original data should\n>     shed light on some aspects of the distribution that are not\n>     determined by null hypothesis. For example, a null hypothesis\n>     about a mean doesn't tell us about the shape of the population\n>     distribution, but the data give us some indication.\n>\n> 7.  Reflect the way the original data were collected.\n\nFrom Chihara and Hesterberg:\n\n> This is the core idea of statistical significance or classical\n> hypothesis testing -- to calculate how often pure random chance would\n> give an effect as large as that observed in the data, in the absence\n> of any real effect. If that probability is small enough, we conclude\n> that the data provide convincing evidence of a real effect.\n\n## References\n\n1.  [Chapter 11, Hypothesis Testing with\n    Randomization](https://openintro-ims.netlify.app/foundations-randomization.html#chp11-review)\n    in [Introduction to Modern Statistics (1st\n    Ed)](https://openintro-ims.netlify.app/index.html) by Mine\n    Çetinkaya-Rundel and Johanna Hardin.\n\n2.  [Allen Downey, There is still only one\n    test](https://allendowney.blogspot.com/2016/06/there-is-still-only-one-test.html)\n\n3.  R.A. Fisher. *Statistical Methods for Research Workers*. Oliver &\n    Boyd, 1925\n\n4.  <https://timesofindia.indiatimes.com/sports/cricket/icc-mens-t20-world-cup/in-numbers-virat-kohli-and-his-strange-luck-with-the-coin-toss/articleshow/87538443.cms>\n\n5.  Laura Chihara, Tim Hesterberg, *Mathematical Statistics with\n    Resampling and R*, Wiley, 2019.\n\n6.  D. Salsburg. *The Lady Tasting Tea: How statistics revolutionized\n    science in the twentieth century.* W.H. Freeman, New York, 2001\n\n7.  Daniel Kaplan, Nicholas J. Horton, and Randall Pruim,\n    *Simulation-based inference with mosaic*\n    <https://www.mosaic-web.org/mosaic/articles/Resampling.html>\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../../../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../../../../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}